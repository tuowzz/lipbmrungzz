<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>ลิปสติกบำรุงริมฝีปาก Magic Glow M-BLITHE หลายสี | ปากชุ่มชื้น ไม่แห้งแตก | ส่งฟรี เก็บเงินปลายทาง</title>
  <meta name="description" content="Magic Glow Lipstick จาก M-BLITHE ลิปสติกบำรุงริมฝีปาก ชุ่มชื้นยาวนาน ปากดูสุขภาพดี ไม่แห้งแตก เฉดสวย 6 สี ส่งฟรี เก็บเงินปลายทาง">
  <meta name="keywords" content="ลิปสติกบำรุง, ลิปบาล์ม, Magic Glow, M-BLITHE, ลิปไม่แห้งแตก, ปากชุ่มชื้น, เก็บเงินปลายทาง">
  <link rel="canonical" href="https://tuowzz.github.io/mbshopz.github.io/magicglow" />

  <!-- Facebook Pixel -->
  <script>
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}
    (window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init','127978927946856');
    fbq('track','PageView');
    fbq('track','ViewContent');
  </script>
  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=127978927946856&ev=PageView&noscript=1"/></noscript>

  <!-- TikTok Pixel -->
  <script>
    !function(w,d,t){w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=
    ["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie"];
    ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat([].slice.call(arguments,0)))}};
    for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);
    ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e};
    ttq.load=function(e,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";
      ttq._i=ttq._i||{};ttq._i[e]=[];ttq._i[e]._u=i;ttq._t=ttq._t||{};ttq._t[e]=+new Date;ttq._o=ttq._o||{};
      ttq._o[e]=n||{};var o=d.createElement("script");o.type="text/javascript";o.async=!0;o.src=i+"?sdkid="+e+"&lib="+t;
      var a=d.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};
    ttq.load("D0EVS2JC77U9C23772EG");
    ttq.page();
    ttq.track("ViewContent");
  }(window,document,"ttq");
  </script>

  <!-- Google Ads (gtag) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17035064059"></script>
  <script>
    window.dataLayer=window.dataLayer||[];
    function gtag(){dataLayer.push(arguments);}
    gtag('js',new Date());
    gtag('config','AW-17035064059');
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root{
      --primary:#ee4d2d; /* ปุ่มซื้อ vibe Shopee */
      --brand:#e94057;   /* โทนแบรนด์ M-BLITHE */
      --bg:#f6f7fb; --card:#fff; --line:#eee; --text:#161823; --muted:#888;
      --shadow:0 2px 18px rgba(0,0,0,.06);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{font-family:'Kanit',sans-serif;margin:0;background:var(--bg);color:var(--text);padding-bottom:76px}
    header{background:#fff;box-shadow:var(--shadow);position:sticky;top:0;z-index:50}
    .topbar{display:flex;align-items:center;gap:10px;padding:10px 14px;justify-content:space-between}
    .leftbox{display:flex;align-items:center;gap:10px}
    .shop-logo{width:38px;height:38px;border-radius:50%;background:linear-gradient(135deg,#ff7e5f,#feb47b);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
    .shop-name{font-weight:700}
    .line-btn-top{display:inline-flex;align-items:center;gap:8px;background:#06c755;color:#fff;text-decoration:none;padding:8px 12px;border-radius:10px;font-weight:800;box-shadow:0 2px 10px rgba(6,199,85,.12)}
    .hero{position:relative;background:linear-gradient(135deg,#ffede6,#fff);padding-bottom:10px}
    .gallery{border-bottom:1px solid #f0f0f0}
    .gallery img{width:100%;display:block}
    .voucher-row{display:flex;gap:8px;padding:10px 14px;background:#fff}
    .voucher{flex:1;border:1px dashed var(--primary);border-radius:10px;padding:8px 10px;font-weight:700;color:var(--primary);text-align:center}
    .card{background:var(--card);border-radius:0 0 var(--radius) var(--radius);box-shadow:var(--shadow);margin:0 0 10px 0}
    .pad{padding:14px}
    .price-wrap{display:flex;align-items:flex-end;gap:8px}
    .price{color:var(--primary);font-size:2rem;font-weight:800}
    .price-old{color:#b0b0b0;text-decoration:line-through}
    .badges{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
    .badge{font-size:.9rem;font-weight:700;border-radius:6px;padding:3px 8px;background:#fff5ef;border:1px solid #ffd6c9;color:#c23a1a}
    .rating-line{display:flex;align-items:center;gap:10px;color:#555;margin-top:8px;font-size:.98rem}
    .stars{color:#f9d71c}
    .sold{color:#666}
    .options{display:flex;gap:9px;flex-wrap:wrap}
    .chip{border:1.8px solid #eee;background:#fff;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer;transition:.15s}
    .chip.selected{border-color:var(--primary);background:#ffe7df;color:#c23a1a;box-shadow:0 1px 6px #ffbfab66}
    .qty-row{display:flex;align-items:center;gap:10px;margin-top:8px}
    .step{display:inline-flex;align-items:center;gap:10px;border:1px solid #eee;border-radius:10px;padding:6px}
    .step button{border:none;background:#fff;width:30px;height:30px;border-radius:8px;cursor:pointer}
    .step input{width:46px;border:none;text-align:center;font-weight:700;font-size:1.02rem}
    .benefit{display:flex;align-items:center;gap:10px;margin:10px 0;font-size:1.02rem}
    .benefit i{color:var(--primary)}
    .divider{height:1px;background:#f0f0f0;margin:12px 0}
    .thumb-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .thumb-grid img{width:100%;border-radius:12px;box-shadow:0 2px 8px #0001}
    /* Sticky footer */
    .sticky{position:fixed;left:0;right:0;bottom:0;display:flex;height:62px;background:#fff;border-top:1px solid #eee;box-shadow:0 -2px 14px rgba(0,0,0,.08);z-index:60}
    .btn{display:flex;align-items:center;justify-content:center;font-weight:800;border:none;cursor:pointer}
    .btn-line{width:40%;background:#06c755;color:#fff;text-decoration:none}
    .btn-buy{width:60%;background:var(--primary);color:#fff;font-size:1.14rem}
    /* Modal Sheet */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;z-index:80}
    .sheet{position:absolute;left:0;right:0;bottom:0;background:#fff;border-radius:18px 18px 0 0;box-shadow:var(--shadow);padding:16px;animation:slideUp .18s;max-height:93vh;overflow:auto}
    @keyframes slideUp{from{transform:translateY(30%);opacity:.4}to{transform:translateY(0);opacity:1}}
    .close-x{position:absolute;top:10px;right:14px;color:#bbb;font-size:1.4rem;cursor:pointer}
    .sheet-header{display:flex;gap:12px;align-items:center;border-bottom:1px solid #f0f0f0;padding-bottom:10px;margin-bottom:10px}
    .sheet-header img{width:64px;height:64px;border-radius:10px;border:1px solid #eee;object-fit:cover}
    .form label{display:block;font-weight:700;margin:10px 0 6px}
    .form input,.form textarea{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;font-family:'Kanit',sans-serif;font-size:1rem}
    .submit{width:100%;margin-top:12px;background:var(--primary);color:#fff;border:none;border-radius:10px;padding:14px;font-size:1.06rem;font-weight:800;cursor:pointer}
    .submit:disabled{background:#ddd;cursor:not-allowed}
    .success{display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#fff;border-radius:16px;padding:26px 36px;box-shadow:var(--shadow);z-index:200;text-align:center}
    .success i{font-size:2.6rem;color:var(--brand)}
    .pdpa{font-size:12px;color:#666;margin-top:6px}
    @media(max-width:600px){.pad{padding:13px 10px}.btn-buy,.btn-line{font-size:1.02rem}}
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="topbar">
      <div class="leftbox">
        <div class="shop-logo">MB</div>
        <div>
          <div class="shop-name">M-BLITHE Official</div>
          <div style="font-size:.92rem;color:#666">ของแท้ 100% • ส่งฟรี • เก็บเงินปลายทาง</div>
        </div>
      </div>
      <a href="https://lin.ee/wKelfsp" target="_blank" class="line-btn-top" id="lineBtnTop">
        <i class="fa-brands fa-line"></i> แอดไลน์รับโปร
      </a>
    </div>
  </header>

  <!-- Hero / Gallery -->
  <section class="hero">
    <div class="gallery">
      <img src="magicglow_hero.png" alt="M-BLITHE Magic Glow Lipstick ปากชุ่มชื้น ไม่แห้งแตก">
    </div>
    <div class="voucher-row">
      <div class="voucher">คูปอง ฿20 ขั้นต่ำ ฿199</div>
      <div class="voucher">ลดเพิ่ม ฿10 โค้ด: GLOW10</div>
    </div>
  </section>

  <!-- การ์ดราคา / ตัวเลือก -->
  <section class="card">
    <div class="pad">
      <div class="price-wrap">
        <div class="price">฿199</div>
        <div class="price-old">฿259</div>
      </div>
      <div class="rating-line">
        <span class="stars">★★★★★</span>
        <span>4.9</span>
        <span class="sold">| ขายแล้ว 3.1k</span>
      </div>

      <div class="badges">
        <span class="badge">ส่งฟรี</span>
        <span class="badge">พร้อมส่ง</span>
        <span class="badge">ชำระปลายทาง (COD)</span>
      </div>

      <div class="divider"></div>

      <div style="font-weight:700;margin-bottom:6px">เลือกเฉดสี Magic Glow</div>
      <div class="options" id="optContainer"></div>

      <div class="qty-row">
        <div style="font-weight:700">จำนวน</div>
        <div class="step">
          <button type="button" id="minusBtn">−</button>
          <input id="qtyInput" type="number" min="1" value="1">
          <button type="button" id="plusBtn">+</button>
        </div>
        <div id="stockText" style="color:#888">สต๊อก: 120</div>
      </div>

      <div class="divider"></div>

      <div class="benefit"><i class="fa-solid fa-droplet"></i> บำรุงชุ่มชื้นยาวนาน ปากดูสุขภาพดี ไม่แห้งแตก*</div>
      <div class="benefit"><i class="fa-solid fa-shield-heart"></i> สินค้าแท้ 100% ผิดสีเปลี่ยนได้</div>
      <div class="benefit"><i class="fa-solid fa-truck-fast"></i> ส่งทุกวันจันทร์–เสาร์ แพ็คอย่างดี</div>
      <div style="font-size:.9rem;color:#999">*ผลลัพธ์ขึ้นกับแต่ละบุคคล</div>
    </div>
  </section>

  <!-- เฉดสีแบบโชว์ภาพ (SEO) -->
  <section class="card">
    <div class="pad">
      <h2 style="font-size:1.02rem;margin:0 0 8px 0">✨ เลือกเฉดที่ใช่ (Magic Glow 6 สี)</h2>
      <div class="thumb-grid">
        <img src="831.jpg" alt="831 Bewitching Berry - ลิปสติกสีเบอร์รี่ ปากชมพูอมแดง สุขภาพดี Magic Glow M-BLITHE">
        <img src="832.jpg" alt="832 Mystic Merlot - ลิปสติกสีไวน์แดง บำรุงริมฝีปากนุ่มชุ่มชื้น ไม่แห้งแตก">
        <img src="833.jpg" alt="833 Moon Beam - ลิปสติกสีชมพูอ่อนธรรมชาติ ปากดูใส สุขภาพดี">
        <img src="834.jpg" alt="834 Forbidden Potion - ลิปสติกสีชมพูสด เติมความชุ่มชื้น ริมฝีปากอิ่มน้ำ">
        <img src="835.jpg" alt="835 Crimson Charm - ลิปสติกสีแดงอมชมพู ปากนุ่มน่าสัมผัส บำรุงไม่คล้ำ">
        <img src="836.jpg" alt="836 Lunar Lust - ลิปสติกสีชมพูพีชธรรมชาติ ใช้ได้ทุกวัน ปากดูอ่อนเยาว์">
      </div>
    </div>
  </section>

  <!-- Sticky footer -->
  <div class="sticky">
    <a href="https://lin.ee/wKelfsp" target="_blank" class="btn btn-line" id="lineBtnBottom">
      <i class="fa-brands fa-line" style="margin-right:8px"></i>แอดไลน์รับโปร
    </a>
    <button class="btn btn-buy" id="buyBtn">ซื้อเลย</button>
  </div>

  <!-- Bottom Sheet -->
  <div class="overlay" id="sheet">
    <div class="sheet">
      <i class="fa-solid fa-xmark close-x" id="closeSheet"></i>
      <div class="sheet-header">
        <img src="magicglow_thumb.png" alt="M-BLITHE Magic Glow Lipstick">
        <div>
          <div style="font-weight:700">M-BLITHE Magic Glow Lipstick</div>
          <div id="modalPrice" style="color:var(--primary);font-weight:800;font-size:1.2rem">฿199</div>
        </div>
      </div>

      <div style="font-weight:700;margin-bottom:6px">เลือกเฉดสี</div>
      <div class="options" id="optContainerModal" style="margin-bottom:8px"></div>

      <div class="qty-row" style="margin-bottom:4px">
        <div style="font-weight:700">จำนวน</div>
        <div class="step">
          <button type="button" id="mMinus">−</button>
          <input id="mQty" type="number" min="1" value="1">
          <button type="button" id="mPlus">+</button>
        </div>
      </div>

      <form id="orderForm" class="form" onsubmit="submitOrder(event)" autocomplete="off">
        <!-- ฟิลด์ซ่อนตามสเปก: product ฝังราคา+จำนวน และฟิลด์แยก -->
        <input type="hidden" name="order_id" id="order_id">
        <input type="hidden" name="product" id="productEmbed">
        <input type="hidden" name="product_name" value="M-BLITHE Magic Glow Lipstick">
        <input type="hidden" name="shade_id" id="shade_id">
        <input type="hidden" name="unit_price" id="unit_price" value="199">
        <input type="hidden" name="quantity" id="quantity" value="1">
        <input type="hidden" name="total_price" id="total_price" value="199">
        <input type="hidden" name="sku" id="sku">
        <input type="hidden" name="payment_method" value="COD">
        <input type="hidden" name="source_page" value="magicglow_shopee_style">

        <label for="cust_name">ชื่อ-นามสกุล</label>
        <input type="text" id="cust_name" name="name" required placeholder="กรอกชื่อ-นามสกุล">

        <label for="cust_phone">เบอร์โทรศัพท์</label>
        <input type="text" id="cust_phone" name="phone" required placeholder="0812345678" pattern="^[0-9]{10}$" title="กรอกเบอร์โทร 10 หลัก">

        <label for="cust_addr">ที่อยู่จัดส่ง</label>
        <textarea id="cust_addr" name="address" rows="3" required placeholder="บ้านเลขที่, ถนน, ตำบล, อำเภอ, จังหวัด, รหัสไปรษณีย์"></textarea>

        <div class="pdpa">ข้อมูลของคุณใช้เพื่อยืนยันคำสั่งซื้อและจัดส่งสินค้าเท่านั้น และจะถูกเก็บรักษาตามมาตรการ PDPA ของเรา</div>

        <button class="submit" id="submitBtn" type="submit">ยืนยันสั่งซื้อ</button>
      </form>
    </div>
  </div>

  <div class="success" id="okToast">
    <i class="fa-solid fa-circle-check"></i>
    <div style="margin-top:6px;font-weight:800">สั่งซื้อสำเร็จ!</div>
    <div style="color:#333;margin-top:4px">เจ้าหน้าที่จะติดต่อยืนยันออเดอร์</div>
  </div>

  <script>
    // ===== CONFIG =====
    // ใช้ตัวจริงที่คุณบอกไว้ (ยิงเข้า Google Sheets + Telegram พร้อมกัน)
    const GOOGLE_SHEET_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwLLvLNMk7QqkYIyPgN5efEqcpFzFtEYxuWiCBld5hQvlOf8t8v6vMI19A5q7Dk0-JE0g/exec';

    // ราคา/สินค้า/SEO
    const UNIT_PRICE = 199;
    const PRODUCTS = [
      { id:'831', text:'831 Bewitching Berry (เบอร์รี่)', sku:'MB-MG-831', seo:'ลิปสติกสีเบอร์รี่ ปากชมพูอมแดง สุขภาพดี Magic Glow M-BLITHE' },
      { id:'832', text:'832 Mystic Merlot (ไวน์แดง)', sku:'MB-MG-832', seo:'ลิปสติกสีไวน์แดง บำรุงริมฝีปากนุ่มชุ่มชื้น ไม่แห้งแตก' },
      { id:'833', text:'833 Moon Beam (ชมพูอ่อน)', sku:'MB-MG-833', seo:'ลิปสติกสีชมพูอ่อนธรรมชาติ ปากดูใสอมชมพู สุขภาพดี' },
      { id:'834', text:'834 Forbidden Potion (ชมพูสด)', sku:'MB-MG-834', seo:'ลิปสติกสีชมพูสด เติมความชุ่มชื้น ริมฝีปากอิ่มน้ำ' },
      { id:'835', text:'835 Crimson Charm (แดงอมชมพู)', sku:'MB-MG-835', seo:'ลิปสติกสีแดงอมชมพู ปากนุ่มน่าสัมผัส บำรุงไม่คล้ำ' },
      { id:'836', text:'836 Lunar Lust (พีชธรรมชาติ)', sku:'MB-MG-836', seo:'ลิปสติกสีชมพูพีชธรรมชาติ ใช้ได้ทุกวัน ปากดูอ่อนเยาว์' }
    ];

    // ===== ELEMENTS =====
    const optContainer = document.getElementById('optContainer');
    const optContainerModal = document.getElementById('optContainerModal');
    const qtyInput = document.getElementById('qtyInput');
    const mQty = document.getElementById('mQty');
    const sheet = document.getElementById('sheet');
    const closeSheet = document.getElementById('closeSheet');
    const buyBtn = document.getElementById('buyBtn');
    const unitPriceInput = document.getElementById('unit_price');
    const quantityInput = document.getElementById('quantity');
    const totalPriceInput = document.getElementById('total_price');
    const productEmbed = document.getElementById('productEmbed');
    const shadeIdInput = document.getElementById('shade_id');
    const skuInput = document.getElementById('sku');
    const orderIdInput = document.getElementById('order_id');
    const okToast = document.getElementById('okToast');
    const submitBtn = document.getElementById('submitBtn');

    // ===== Render option chips =====
    function renderChips(){
      [optContainer, optContainerModal].forEach((wrap)=>{
        wrap.innerHTML='';
        PRODUCTS.forEach(p=>{
          const b=document.createElement('button');
          b.type='button';
          b.className='chip';
          b.dataset.id=p.id;
          b.dataset.text=p.text;
          b.dataset.sku=p.sku;
          b.onclick=()=>selectShade(p.id);
          b.textContent=p.text;
          wrap.appendChild(b);
        });
      });
    }
    function selectShade(id){
      document.querySelectorAll('.options .chip').forEach(el=>{
        if(el.dataset.id===id){ el.classList.add('selected'); } else { el.classList.remove('selected'); }
      });
      const chosen = PRODUCTS.find(x=>x.id===id);
      if(!chosen) return;
      shadeIdInput.value = chosen.id;
      skuInput.value = chosen.sku;
      updateEmbed();
    }

    // ===== Default: render & select first =====
    renderChips();
    selectShade(PRODUCTS[0].id);

    // ===== Quantity steppers =====
    document.getElementById('minusBtn').onclick=()=>{ if(qtyInput.value>1){ qtyInput.value--; syncQty(); } };
    document.getElementById('plusBtn').onclick=()=>{ qtyInput.value++; syncQty(); };
    document.getElementById('mMinus').onclick=()=>{ if(mQty.value>1){ mQty.value--; syncQty('modal'); } };
    document.getElementById('mPlus').onclick=()=>{ mQty.value++; syncQty('modal'); };

    qtyInput.addEventListener('input',()=>syncQty());
    mQty.addEventListener('input',()=>syncQty('modal'));

    function syncQty(src){
      let q = 1;
      if(src==='modal'){
        q = Math.max(1, parseInt(mQty.value||'1',10));
        mQty.value = q;
        qtyInput.value = q;
      }else{
        q = Math.max(1, parseInt(qtyInput.value||'1',10));
        qtyInput.value = q;
        mQty.value = q;
      }
      quantityInput.value = q;
      totalPriceInput.value = (q * UNIT_PRICE).toFixed(2);
      updateEmbed();
    }

    function updateEmbed(){
      // ถ้ายังไม่ได้เลือกเฉด ให้เลือกอัตโนมัติ (กันเคสกดซื้อไม่ได้)
      if(!shadeIdInput.value){
        selectShade(PRODUCTS[0].id);
      }
      const q = parseInt(quantityInput.value||'1',10);
      const shade = PRODUCTS.find(x=>x.id===shadeIdInput.value);
      const name = 'M-BLITHE Magic Glow Lipstick';
      const embed = `${name} - ${shade ? shade.text : ''} - ฿${UNIT_PRICE} x${q}`;
      productEmbed.value = embed;
    }

    // ===== Open/Close sheet =====
    buyBtn.onclick=()=>{
      sheet.style.display='block';
      const val = UNIT_PRICE * parseInt(quantityInput.value||'1',10);
      if(window.fbq){ fbq('track','AddToCart',{value:val,currency:'THB'}); fbq('track','InitiateCheckout',{value:val,currency:'THB'}); }
      if(window.ttq){ ttq.track('AddToCart'); ttq.track('InitiateCheckout'); }
      if(window.gtag){ gtag('event','begin_checkout',{value:val,currency:'THB'}); }
    };
    closeSheet.onclick=()=>sheet.style.display='none';
    sheet.addEventListener('click',e=>{ if(e.target===sheet){ sheet.style.display='none'; }});

    // ===== LINE tracking =====
    function trackLine(){
      if(window.fbq) fbq('track','Contact');
      if(window.ttq) ttq.track('Contact');
    }
    document.getElementById('lineBtnTop').addEventListener('click',trackLine);
    document.getElementById('lineBtnBottom').addEventListener('click',trackLine);

    // ===== Submit to Google Apps Script (เพิ่มความทนทาน) =====
    async function submitOrder(e){
      e.preventDefault();

      // กันเคสไม่ได้เลือกเฉด
      if(!shadeIdInput.value){ selectShade(PRODUCTS[0].id); }

      // สร้าง Order ID
      orderIdInput.value = 'ORD-' + Date.now();

      // กันชีตตัด 0 เบอร์โทร: prepend "'" เสมอ
      const phoneEl = document.getElementById('cust_phone');
      if(phoneEl && phoneEl.value && !phoneEl.value.startsWith("'")){
        phoneEl.value = "'" + phoneEl.value;
      }

      // ล็อกปุ่ม
      submitBtn.disabled = true;
      const oldLabel = submitBtn.textContent;
      submitBtn.textContent = 'กำลังส่งข้อมูล...';

      // ฟังก์ชันแปลง response ให้รองรับ JSON หรือ Text
      async function parseMaybeJSON(res){
        const contentType = res.headers.get('content-type') || '';
        if(contentType.includes('application/json')){
          return await res.json();
        } else {
          const text = await res.text();
          return { result: (text.toLowerCase().includes('success')?'success':'unknown'), raw:text };
        }
      }

      // ส่งคำขอพร้อม timeout ป้องกันค้าง
      const controller = new AbortController();
      const t = setTimeout(()=>controller.abort(), 15000); // 15s

      try{
        const form = new FormData(document.getElementById('orderForm'));
        console.log('[ORDER] submitting to Apps Script:', GOOGLE_SHEET_WEB_APP_URL);

        let res = await fetch(GOOGLE_SHEET_WEB_APP_URL,{
          method:'POST',
          body: form,
          signal: controller.signal
        });
        clearTimeout(t);

        const data = await parseMaybeJSON(res);
        console.log('[ORDER] response:', data);

        submitBtn.disabled=false; submitBtn.textContent=oldLabel;

        if(res.ok && (data.result==='success' || data.raw)){
          // Success (รองรับทั้ง JSON และ Text)
          sheet.style.display='none';
          document.getElementById('orderForm').reset();
          selectShade(PRODUCTS[0].id);
          qtyInput.value = 1; mQty.value = 1; syncQty();

          okToast.style.display='block';
          setTimeout(()=>okToast.style.display='none',2200);

          const total = parseFloat(totalPriceInput.value||UNIT_PRICE);
          if(window.fbq) fbq('track','Purchase',{value: total, currency:'THB'});
          if(window.ttq) ttq.track('CompletePayment',{
            contents:[{content_id: skuInput.value || 'MB-MG', content_type:'product', quantity: parseInt(quantityInput.value||'1',10)}],
            value: total, currency:'THB'
          });
          if(window.gtag){
            gtag('event','conversion',{'send_to':'AW-17035064059/53zPCNHE2OIaEPvl-bo_','value': total,'currency':'THB'});
          }
        }else{
          alert('เกิดข้อผิดพลาด: ' + (data.raw || data.message || res.status + ' ' + res.statusText));
        }
      }catch(err){
        clearTimeout(t);
        submitBtn.disabled=false; submitBtn.textContent=oldLabel;
        console.error('[ORDER] error:', err);
        alert('ส่งข้อมูลไม่สำเร็จ กรุณาลองใหม่อีกครั้งหรือติดต่อทางไลน์\nรายละเอียด: ' + (err.message || err));
      }
    }

    // ===== INIT =====
    unitPriceInput.value = UNIT_PRICE.toString();
    syncQty();

    // Hashtag/SEO helper
    console.log('#MagicGlow #mblithe #lipstick #ลิปสติกบำรุง #ปากชุ่มชื้น #ไม่แห้งแตก #ส่งฟรี #COD');
  </script>

  <!-- JSON-LD (Product) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org/",
    "@type":"Product",
    "name":"M-BLITHE Magic Glow Lipstick",
    "image":["magicglow_hero.png","magicglow_thumb.png","831.jpg","832.jpg","833.jpg","834.jpg","835.jpg","836.jpg"],
    "brand":{"@type":"Brand","name":"M-BLITHE"},
    "sku":"MB-MG",
    "offers":{
      "@type":"Offer",
      "priceCurrency":"THB",
      "price":"199",
      "availability":"https://schema.org/InStock",
      "url":"https://tuowzz.github.io/mbshopz.github.io/magicglow"
    },
    "additionalProperty": [
      {"@type":"PropertyValue","name":"Variations","value":"831 Bewitching Berry, 832 Mystic Merlot, 833 Moon Beam, 834 Forbidden Potion, 835 Crimson Charm, 836 Lunar Lust"}
    ]
  }
  </script>
</body>
</html>
